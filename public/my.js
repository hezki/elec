function init_data(){$$.on("type.int.validate",function(e){return e&&"number"!=typeof e&&e.replace(/[\-0-9]/g,"")?"הערך אינו מספר שלם":void 0}),$$.on("type.float.validate",function(e){return e&&"number"!=typeof e&&e.replace(/[0-9\.\-]/g,"")?"הערך אינו מספר תקין":void 0}),$$.on("type.decimal.validate",function(e){return e&&"number"!=typeof e&&e.replace(/[0-9\.\-]/g,"")?"הערך אינו מספר תקין":void 0}),$$.on("type.required.validate",function(e){return e||0===e?void 0:"ערך חובה"}),init_events&&init_events()}function strtotime(e,t){function o(e,t,o){var n,r=c[t];"undefined"!=typeof r&&(n=r-l.getDay(),0===n?n=7*o:n>0&&"last"===e?n-=7:0>n&&"next"===e&&(n+=7),l.setDate(l.getDate()+n))}function n(e){var t=e.split(" "),n=t[0],r=t[1].substring(0,3),i=/\d+/.test(n),a="ago"===t[2],s=("last"===n?-1:1)*(a?-1:1);if(i&&(s*=parseInt(n,10)),d.hasOwnProperty(r)&&!t[1].match(/^mon(day|\.)?$/i))return l["set"+d[r]](l["get"+d[r]]()+s);if("wee"===r)return l.setDate(l.getDate()+7*s);if("next"===n||"last"===n)o(n,r,s);else if(!i)return!1;return!0}var r,i,a,s,l,c,d,u,p,f,h,g=!1;if(!e)return g;if(e=e.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase(),i=e.match(/^(\d{1,4})([\-\.\/\:])(\d{1,2})([\-\.\/\:])(\d{1,4})(?:\s(\d{1,2}):(\d{2})?:?(\d{2})?)?(?:\s([A-Z]+)?)?$/),i&&i[2]===i[4])if(i[1]>1901)switch(i[2]){case"-":return i[3]>12||i[5]>31?g:new Date(i[1],parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3;case".":return g;case"/":return i[3]>12||i[5]>31?g:new Date(i[1],parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3}else if(i[5]>1901)switch(i[2]){case"-":return i[3]>12||i[1]>31?g:new Date(i[5],parseInt(i[3],10)-1,i[1],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3;case".":return i[3]>12||i[1]>31?g:new Date(i[5],parseInt(i[3],10)-1,i[1],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3;case"/":return i[1]>12||i[3]>31?g:new Date(i[5],parseInt(i[1],10)-1,i[3],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3}else switch(i[2]){case"-":return i[3]>12||i[5]>31||i[1]<70&&i[1]>38?g:(s=i[1]>=0&&i[1]<=38?+i[1]+2e3:i[1],new Date(s,parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3);case".":return i[5]>=70?i[3]>12||i[1]>31?g:new Date(i[5],parseInt(i[3],10)-1,i[1],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3:i[5]<60&&!i[6]?i[1]>23||i[3]>59?g:(a=new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate(),i[1]||0,i[3]||0,i[5]||0,i[9]||0)/1e3):g;case"/":return i[1]>12||i[3]>31||i[5]<70&&i[5]>38?g:(s=i[5]>=0&&i[5]<=38?+i[5]+2e3:i[5],new Date(s,parseInt(i[1],10)-1,i[3],i[6]||0,i[7]||0,i[8]||0,i[9]||0)/1e3);case":":return i[1]>23||i[3]>59||i[5]>59?g:(a=new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate(),i[1]||0,i[3]||0,i[5]||0)/1e3)}if("now"===e)return null===t||isNaN(t)?(new Date).getTime()/1e3|0:0|t;if(!isNaN(r=Date.parse(e)))return r/1e3|0;if(l=t?new Date(1e3*t):new Date,c={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},d={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},p="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)",f="([+-]?\\d+\\s"+p+"|(last|next)\\s"+p+")(\\sago)?",i=e.match(new RegExp(f,"gi")),!i)return g;for(h=0,u=i.length;u>h;h++)if(!n(i[h]))return g;return l.getTime()/1e3}function show_err(e,t){var o=$(e);if(t)if(o.hasClass("form-control")?o.closest(".form-group").addClass("has-error"):o.addClass("has-error"),$(".help-block",e).length)$(".help-block",e).html(t);else{var n=parseInt($("td").css("padding"))||0;o.is("input")&&(e=o.parent()[0]),$('<div class="tootip-err"><div/></div>').prependTo(e).css({marginTop:$(e).height()+n,width:$(e).width()+n,position:"absolute"}).find("div").tooltip({trigger:"manual",placement:"bottom",title:t,template:'<div class="tooltip tooltip-err" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}).tooltip("show")}else o.hasClass("form-control")?o.closest(".form-group").removeClass("has-error"):o.removeClass("has-error"),$(".help-block",e).length?$(".help-block",e).html(""):(o.is("input")&&(o=o.parent()),o.find(".tootip-err").remove())}function proc_lookup(e,t){var o,n,r=e;"object"==typeof r&&(o=r.fld,n=r.id,r=r.src);var i=$$;r.split(".").forEach(function(e){i=i&&e in i?i[e]:null});var a={};if(i)if(i instanceof Array&&n)i.forEach(function(e){a[e[n]]=e});else if(n)for(var s in i)a[d[n]]=d;else a=i;var l={initial:null===i?0:1,lookup_fld:o,lookup_id:n,lookup_obj:function(o,n,r){var i=e&&e.lookup_obj?e.lookup_obj(o,n,r,l.all):l.all;return o&&t&&t.is_combo&&i instanceof Array&&i.indexOf(o)<1&&i.push(o),i},all:a,lookup:function(t,o,n){var t=e&&e.lookup?e.lookup(t,o,n,l.all):l.all[t];return void 0===t?"":l.lookup_fld?t[l.lookup_fld]:t},map:function(e,t,o){for(var n in l.all){var r=l.all[n];if((!l.lookup_fld||r[l.lookup_fld]==e)&&(l.lookup_fld||r==e))return n}return""}};return l}function show_lookup(e){function t(e){var t=n.data("my").aft_cb;t&&t(e)}function o(e,t){var o=n.data("my").new_cb;o&&o(e,t)}var n=$("#lookup");n.length||(n=$('<div id="lookup"></div>').appendTo("#matle"),$$.on("lookup_add_val",function(e,t){o(e,t)}),template=e.select2?'<div style="padding:3px"><select value="{{value}}" add_event="lookup_add_val" lookup="lookup" class="form-control input-sm select2"><option value="{{value}}" selected="selected">{{vis}}</option></select></div>':'<div style="padding:3px"><select required="" value="{{value}}" add_event="lookup_add_val" lookup="lookup" class="form-control input-sm combobox"><option value="{{value}}" selected="selected">{{vis}}</option></select></div>',n.data("my",{rst:new_rst({name:"lookup",template:template})}),register_inline("lookup",{onclose:function(e){t(e&&void 0!==e.value?e.value:"")}}));var r={value:e.v,vis:e.look.lookup(e.v,e.obj,e.key),lookup:e.look.lookup_obj(e.v,e.obj,e.key)},i=$("select.combobox",n);e.look.lookup_fld&&i.attr("lookup_fld",e.look.lookup_fld),e.look.lookup_id&&i.attr("lookup_id",e.look.lookup_id),i.combobox("refresh");var a=i.data().combobox;a.ract.lookup_fld=e.look.lookup_fld,a.ract.lookup_id=e.look.lookup_id,$$.uniq.show("lookup",e.on_el,"#lookup",r);var s=n.data("my");s.aft_cb=e.aft_cb,s.new_cb=e.new_cb}function register_inline(e,t){var o,n=["text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right"];$$.uniq.register(e,function(e,r,i){var a=$(r),s=$(e),l=a.children()[0];l&&l._ractive&&l._ractive.root.set(i);var c=function(){$("#matle").append(a),a.off("focusout",d).off("keydown",u),t&&t.onclose&&t.onclose(l?l._ractive.root.get():i)},d=function(e){var t=$(this);setTimeout(function(){o&&(document.activeElement==t[0]||t.has(document.activeElement).length||o.UID==c.UID&&(c(),o=null))},100)},u=function(e){13===e.which||27==e.which?(c(),s.focus(),Yes.stop(e)):9===e.which&&s.focus()};a.attr("tabindex",1).on("focusout",d).on("keydown",u),a.css("position","absolute").appendTo(s.parent()).offset(s.offset()).css(s.css(n)).width(s.innerWidth()).height(s.innerHeight()),a.find(":text,:radio,:checkbox,select,textarea").filter(function(){return!this.readOnly&&!this.disabled&&"none"!=$(this).parentsUntil(a).css("display")}).focus().select(),o=c},function(){o&&o(),o=null})}function register_menu(e,t){var o;$$.uniq.register(e,function(e,n,r){var i=$(n),a=($(e),i.children()[0]);a&&a._ractive&&a._ractive.root.set(r);var s=function(){i.hide(),t&&t.onclose&&t.onclose(a?a._ractive.root.get():r)};o=s;var l,c=event,d=function(){l=setTimeout(s,100)},u=function(){clearTimeout(l)};i.on("mouseenter",u).on("mouseleave",d),i.appendTo($("body")).css({position:"absolute",left:c.pageX,top:c.pageY}).show()},function(){o&&o(),o=null})}function show_popup(e){var t=$(e);return t.length?(t[0]._mask||(t[0]._mask=$("<div/>").appendTo($("body")).css({position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#000",display:"none",zIndex:9988}).click(function(o){t[0]._body_class||$("body").removeClass("modal-open"),$(e).fadeTo(350,0),$(this).fadeTo(350,0,function(){$(this).hide(),$(e).hide()})})),t[0]._body_class=$("body").hasClass("modal-open"),$("body").addClass("modal-open"),t.fadeTo(350,1),void $(t[0]._mask).fadeTo(350,.35)):!1}function register_pop(e,t,o){$$.uniq.register(e,function(n,r){var i=$('<span><span class="text-info"><strong>'+t+'</strong></span> <button type="button" class="close">&times;</button></span>'),a=$('<div class="popover" style="z-index:10000" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>');a.on("click",".close",function(){$$.uniq.hide(e)});var s=$.extend({},{animation:!1,html:!0,container:"body",content:r,placement:"auto top",trigger:"manual",title:i,template:a},o),l=0;$(n).popover(s).on("hidden.bs.popover",function(){$("#matle").append(r)}).on("hide.bs.popover",function(){l&&o&&o.onclose&&o.onclose(n,e),l&&window._modal_mopen.splice(window._modal_mopen.indexOf(r.closest(".popover")),1),l=0}).on("shown.bs.popover",function(){$("table",r).yesEditTable().find("td.edited").first().focus(),l=1,window._modal_mopen.push(r.closest(".popover")[0])}),$(n).popover("show")},function(e){try{$(e).popover("hide")}catch(t){}})}function new_rst(e,t,o,n){function r(e){function t(e,t){if(document.createEvent){var o=document.createEvent("HTMLEvents");o.initEvent(t,!1,!1),e.dispatchEvent(o)}else document.createEventObject&&e.fireEvent("on"+t)}$(e).data("my_attach")||($(e).change(function(e){this._in_fire||(this._in_fire=1,t(this,"change"),this._in_fire=0)}),$(e).data("my_attach",1))}function i(e,t,o){var n=e[t];e[t+"_src"]=n,e[t]=function(){c._updating=!1;try{n.apply(this,arguments),$.fn.bootstrapToggle&&$("input.toggle",c.el).each(function(){$(this).data("bs.toggle")||$(this).bootstrapToggle(),r(this)}),$.fn.combobox&&$("select.combobox",c.el).each(function(){$(this).data("combobox")?$(this).combobox("refresh"):$(this).combobox(),r(this)}),$.fn.multiselect&&$("select.multiselect",c.el).each(function(){$(this).data("multiselect")||$(this).multiselect({}),r(this)}),$.fn.select2&&$("select.select2",c.el).each(function(){if($(this).data("select2")){if(this._in_fire)return;var e=this._in_fire;this._in_fire=1,$("option",this).data("data",null),$(this).trigger("change.select2"),this._in_fire=e}else $(this).select2({dir:"rtl",width:"100%",closeOnSelect:!$(this).hasClass("noclose")});r(this)})}finally{c._updating=!1}}}var a=0,s="",l=0;"object"==typeof e&&(t=e.mapEvents,o=e.lazy,n=e.dataEvent,a=e.mapLocal,s=e.template,l=e.on_rows,e=e.name);var c=$$.rsts[e]=new Ractive({el:"#"+e,template:s||"#t"+e,lazy:!!o,debug:!1});if(c.name=e,i(c,"set"),i(c,"reset"),i(c,"push"),i(c,"merge"),i(c,"splice"),i(c,"update",1),n||(n="data."+e+".refreshed"),$$.on("rst."+e+".error",function(e,t,o){if(o)c.data.errors[e+"."+t]={path:e,fld:t,error:o};else if(t){if(!(e+"."+t in c.data.errors))return;delete c.data.errors[e+"."+t]}else{if(!e)return c.set("errors",{});for(var n in c.data.errors)c.data.errors[n].path==e&&delete c.data.errors[n]}c.update("errors")}),$$.on(n,function(t,o){return o?(c.reset(t),void $$.emit("rst."+e+".updated")):(t instanceof Array?c.reset({rows:t}):c.reset({row:t}),void $$.emit("rst."+e+".updated"))}),t){var d=[];for(var u in t)if("/"!=u[0]&&"~"!=u[0])!function(e){c.observe(e,function(o,n,r){$$.emit(t[e],o,n,r)},{init:!1,defer:!0})}(t[u]);else{var p=u;if("~"==p[0])var f="^"+p.substr(1).replace(/\*/g,"[^\\.]*").replace(/\./g,"\\.")+"$",h=new RegExp(f);else var g=p.match(/.*\/([gimy]*)$/)?p.replace(/.*\/([gimy]*)$/,"$1"):"",f=p.replace(new RegExp("^/(.*?)/"+g+"$"),"$1"),h=new RegExp(f,g);d.push([h,t[u]])}c.on("change",function(t){t&&Object.keys(t).forEach(function(t){if(t&&"$"!=t[0]){if(t.match(/^rows\.\[\d+\]\.[\.]+$/)||t.match(/^row\.[\.]+$/)){var o=path.split("."),n=o.pop();o=o.join(".");var r=c._olds?c._olds[t]:void 0;$$.emit("rst."+e+".updated",o,n,c.get(t),r)}d.forEach(function(e){if(e&&e[0]){var o=t;if(o.match(e[0])){o=o.split(".");for(var n=o.pop(),r=[];o.length;)r.push(c.get(o.join("."))),o.pop();r.push(c.data);var i=r[0][n],s=c._olds?c._olds[t]:void 0;i!==s&&("string"==typeof e[1]?a?c.data.emit.call(r[0],e[1],i,s,t,r,c.DOM):$$.emit.call(r[0],e[1],i,s,t,r,c.DOM):e[1].call(r[0],i,s,t,r,c.DOM))}}})}})})}else l||c.on("change",function(t){t&&Object.keys(t).forEach(function(t){if(t&&"$"!=t[0]&&(t.match(/^rows\.\[\d+\]\.[^\.]+$/)||t.match(/^row\.[^\.]+$/))){var o=t.split("."),n=o.pop();o=o.join(".");var r=c._olds?c._olds[t]:void 0;$$.emit("rst."+e+".updated",o,n,c.get(t),r)}})});return l&&(c.rows=c.observe("rows.*.* row.*",function(t,o,n){if(!c._updating&&t!==o&&("number"!=typeof t&&"number"!=typeof o||o!=t)){var r=n.split("."),i=r.pop();r=r.join("."),$$.emit("rst."+e+".updated",r,i,t,o)}})),c}function new_dlg(e,t,o){var n=t?new_rst(t,0,1):void 0,r=$$.dlgs[e]=$("#"+e),i=!(o&&"modal"in o&&!o.modal);i?r.appendTo("body").modal({backdrop:"modal"in o&&!o.modal?!1:"static",show:0}):($(".close",r).click(function(t){$$.emit("dlg."+e+".close")}),r.removeClass("modal").removeClass("fade"),$(".modal-dialog",r).addClass("fixed")),r.on("shown.bs.modal",function(){$("input:text:visible:first",this).focus(),$$.emit("dlg."+e+".showed")}).on("hide.bs.modal",function(){$$.emit("dlg."+e+".closed")}),$(".minimize",r).click(function(e){r._minimize={width:$(".modal-content",r).width(),height:$(".modal-content",r).height()},$(".modal-header",r).animate({padding:3},200),$(".modal-title",r).css({width:70,overflow:"hidden"}),$(".modal-content",r).animate({width:150,height:35},200,function(){$(".minimize",r).hide(),$(".restore",r).show()}),this.blur()}),$(".restore",r).click(function(e){var t=r._minimize;delete r._minimize,$(".modal-header",r).animate({padding:15},200),$(".modal-content",r).animate({width:t.width,height:t.height},200,function(){$(".modal-title",r).css({width:"auto",overflow:"visible"}),$(".minimize",r).show(),$(".restore",r).hide()})}),$(".modal-content",r).draggable({handle:".modal-header"}).on("resize",function(e,t){return r._minimize?(t.size.width=150,void(t.size.height=35)):void(t.position.left=t.originalPosition.left)}).resizable({handles:" s, w,sw"}),r.rst=n,r.flds=[];var a=$(".save",r);$$.on("dlg."+e+".error",function(e,t){n&&n.set("errors."+e,t)}),$$.on("dlg."+e+".showed",function(){var e=$(".modal-header",r);e.length&&e[0].getBoundingClientRect().top<0&&$(".modal-dialog",r).removeClass("fixed").css({position:"absolute",right:10,top:10,width:$("body").width()-20})}),$$.on("dlg."+e+".show",function(t,o){r.data=t,$(".modal-body",r).css({"max-height":$(window).height()-155,"overflow-y":"auto"}),t&&r.rst&&r.rst.reset(t),i?r.modal("show"):(r.hide(),$(".modal-dialog",r).css("zIndex",99),$("body").append(r),r.show(300,function(){$$.emit("dlg."+e+".showed"),r.trigger($.Event("shown.bs.modal"))}))}),$$.on("dlg."+e+".save",function(){if(!a.hasClass("disabled"))try{var t=r.rst?r.rst.get():void 0,o=$$.emit("dlg."+e+".validate",t);if(o)throw new Error(o);$$.emit("dlg."+e+".close",t)}catch(n){return void alert(n)}}),$$.on("dlg."+e+".close",function(){i?r.modal("hide"):($("#matle").append(r),$$.emit("dlg."+e+".closed"),r.trigger($.Event("hidden.bs.modal")))}),$$.on("dlg."+e+".save.disable",function(){a.addClass("disabled")}),$$.on("dlg."+e+".save.enable",function(){a.removeClass("disabled")})}function new_grid(e,t){function o(e){function t(e,t){if(e.className+=" lookup",e.lookup={src:e.lookup?e.lookup:e.combo,fld:e.data},e.combo&&(e.lookup.opt={is_combo:1}),e.lookup.info||(e.lookup.info=proc_lookup(e.lookup.src,e.lookup.opt)),"lookup"==t){var o=e.render;e.render=function(t,n,r){e.lookup.info.initial||(e.lookup.info=proc_lookup(e.lookup.src));var i=e.lookup.info.lookup(t,r,e.data);return o?o(i,n,r):i}}}var o=r.columns[e];o.edit&&(o.className=(o.className||"")+" edited"),"date"!=o.type&&"datetime"!=o.type&&"time"!=o.type||(o.className=(o.className||"")+" "+o.type,"datetime"==o.type&&(o.className+=" ltr "),"date"!=o.type||o.render||(o.render=function(e,t){var o=Yes.dt2str(new Date(e));return o?'<span title="'+o+'">'+Yes.dt2str("yyyy-MM-dd",new Date(e))+"</span>":""}),"datetime"!=o.type||o.render||(o.render=function(e,t){var o=Yes.dt2str("yyyy-MM-dd hh:mm",new Date(e));return o?'<span dir="ltr">'+o+"</span>":""}),"time"!=o.type||o.render||(o.render=function(e,t){var o=Yes.dt2str("hh:mm:ss",new Date(e));return o?"<span>"+o+"</span>":""})),"color"==o.type&&(o.render||(o.render=function(e,t){return"sort"==t?e:"filter"==t?e:'<input class="input_color" type="color" value="'+e+'">'})),"checkbox"==o.type&&(o.edit&&!o.clickEvent&&(o.className=(o.className||"")+" grid_checkbox"),o.render||(o.render=function(e,t){if("sort"==t)return e;if("filter"==t)return e?1:0;var n=o.clickEvent?" onclick=\"$$.emit('"+o.clickEvent+"',$(this).closest('td'))\" ":o.edit?"":'onclick="return false"';return"<input "+n+' type="checkbox" '+(e?'checked=""':"")+'></input><span class="print hide">'+(e?"&#10004;":"")+"</span>"})),(o.lookup||o.combo)&&t(o,o.lookup?"lookup":"combo")}var n,r=t,i={bSelectedOnly:!0,oSelectorOpts:{filter:"applied"}},a=[],s=["csv","xls","copy","print"];if(r.btns||(r.btns={}),!r.no_std)for(var l=0;l<s.length;l++)s[l]in r.btns&&r.btns[s[l]]?delete r.btns[s[l]]:r.btns[s[l]]=1;var c=function(e){return e.newline?e.newline:navigator.userAgent.match(/Windows/)?"\r\n":"\n"},d=function(e,t){for(var o=c(t),n=e.buttons.exportData(t.exportOptions),r=t.fieldBoundary,i=t.fieldSeparator,a=new RegExp(r,"g"),s=void 0!==t.escapeChar?t.escapeChar:"\\",l=function(e){for(var t="",o=0,n=e.length;n>o;o++)o>0&&(t+=i),t+=r?r+(""+e[o]).replace(a,s+r)+r:e[o];return t},d=t.header?l(n.header)+o:"",u=t.footer&&n.footer?o+l(n.footer):"",p=[],f=0,h=n.body.length;h>f;f++)p.push(l(n.body[f]));return{str:d+p.join(o)+u,rows:p.length}};for(var u in r.btns)switch(u){case"csv":a.push($.extend({extend:"csv",exportOptions:{orthogonal:"export"}},i));break;case"xls":a.push($.extend({extend:"excel",text:"אקסל",exportOptions:{orthogonal:"export",stripNewlines:!1}},i));break;case"copy":a.push($.extend({},{text:"העתקה",fieldSeparator:"	",fieldBoundary:"",header:!0,footer:!1,exportOptions:{orthogonal:"export",stripNewlines:!1},action:function(e,t,o,n){var r=d(t,n),i=r.str;if(document.queryCommandSupported("copy"))try{return void(Yes.copy(i)?t.buttons.info(t.i18n("buttons.copyTitle","Copy to clipboard"),t.i18n("buttons.copySuccess",{1:"Copied one row to clipboard",_:"Copied %d rows to clipboard"},r.rows),2e3):bootbox.prompt({inputType:"textarea",title:"הקש ctrl+c להעתקה",value:i,callback:function(){}}).on("shown.bs.modal",function(){var e=$("textarea",this)[0];setTimeout(function(){e.select(),e.focus()},500)}))}catch(a){}var s=$("<span>"+t.i18n("buttons.copyKeys","Press <i>ctrl</i> or <i>⌘</i> + <i>C</i> to copy the table data<br>to your system clipboard.<br><br>To cancel, click this message or press escape.")+"</span>").append(hiddenDiv);t.buttons.info(t.i18n("buttons.copyTitle","Copy to clipboard"),s,0),textarea[0].focus(),textarea[0].select();var l=$(s).closest(".dt-button-info"),c=function(){l.off("click.buttons-copy"),$(document).off(".buttons-copy"),t.buttons.info(!1)};l.on("click.buttons-copy",c),$(document).on("keydown.buttons-copy",function(e){27===e.keyCode&&c()}).on("copy.buttons-copy cut.buttons-copy",function(){c()})}}));break;case"print":a.push($.extend({extend:"print",text:"הדפסה",exportOptions:{orthogonal:"export",stripNewlines:!1}},i));break;case"space":a.length&&(a[a.length-1].className=(a[a.length-1].className||"")+" grid_btn_space");break;default:"string"==typeof r.btns[u]?a.push($.extend({},{text:u,ev:r.btns[u],action:function(e,t,o,n){$$.emit(n.ev,t,o,n)}})):(r.btns[u].text=u,a.push(r.btns[u]))}for(var l=0;l<r.columns.length;l++)o(l);""===r.dom&&void 0===r.paging&&(r.paging=!1),n=$$.grids[e]=$("#"+e).DataTable($.extend({},{renderer:"bootstrap",processing:!0,aaSorting:[],drawCallback:function(t){$("tbody td","#"+e).prop("tabindex",1),p&&$$.emit("grid."+e+".select",null),p=null,f=null,$$.emit("grid."+e+".draw")},stateSave:!0,dom:"<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-6'B>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",deferRender:!0,buttons:a,language:{url:"/bootstrap-3.0.0/assets/js/heb.lang"}},t)),n["export"]=function(e){return d(n,e).str},n.reset_lookup=function(){r.columns.forEach(function(e){e.lookup&&e.lookup.info&&delete e.lookup.info.initial})};var p,f;$("#"+e).on("focus","td",function(t){var o=n.data(t.target);o!=p&&($$.emit("grid."+e+".select",o,t.target),f=$(t.target).closest("tr")),p=o}).on("click",".grid_checkbox input[type=checkbox]",function(t){var o=$(t.target).closest("td");$$.emit("grid."+e+".update",o,t.target.checked?1:0)}).on("change","input[type=color]",function(t){var o=$(t.target).closest("td");$$.emit("grid."+e+".update",o,t.target.value)}),n.last=function(){return p},n.lastRow=function(){return f},n.name=e,n.pos=function(e){var t=$(e);if(t.length){t=t[0];var o=n.jquery.fnGetPosition(t);return{r:o[0],c:o[2],cv:o[1],def:n.settings()[0].aoColumns[o[2]]}}},n.find=function(e,t){var o=n.settings()[0].aoData;if(o.length){t||(t=Object.keys(o[0]._aData)[0]);var r;return o.forEach(function(o,n){return o&&o._aData&&o._aData[t]==e?(r=o,!1):void 0}),r?r.nTr:r}},n.data=function(e,t){if(void 0==t)return"TR"==$(e).prop("tagName")?n.row($(e)[0]).data():n.row($(e).closest("TR")[0]).data();var o;o="TR"==$(e).prop("tagName")?n.row($(e)[0]):n.row($(e).closest("TR")[0]),o?o.data(t):Yes.err("not found row")},n.fld=function(e){var t=n.cell("selector"in e?e[0]:e),o=n.settings()[0].aoColumns[t.index().column];return void 0!==o.data?o.data:t.index().column},n.def=function(e){var t=n.cell("selector"in e?e[0]:e);if(t.length)return n.settings()[0].aoColumns[t.index().column]},n.jquery=$("#"+e).on("init.dt",function(){$("#"+e).yesEditTable({dataTable:n,$$:$$,selectRow:t.selectRow}),$(n.table().header()).find("th").append('<i class="tbl_filtered glyphicon glyphicon-filter"></i>'),$(n.table().header()).closest(".dataTables_wrapper").prepend('<span class="btn btn-xs btn-default tbl_filter"><i class="glyphicon glyphicon-filter"></i> סינון</span>'),0!==t.req&&$$.on("window.ready.after",function(){$$.emit("grid."+e+".refresh")})}).dataTable();var h=r.dataEvent?r.dataEvent:"data."+e;n.filter=function(e){return void 0===e?!!n._filter_func:e?($.fn.dataTableExt.afnFiltering.length||$.fn.dataTableExt.afnFiltering.push(function(e,t,o,n){var r=$$.grids[e.nTable.getAttribute("id")];return r._filter_func?r._filter_func(n,o):!0}),void(n._filter_func=e)):n._filter_func=null},$$.on("grid."+e+".refresh",function(){if(!$$.exists(h+".request")){if(!$$.exists(h+".refresh"))throw new Error("not handler for "+h+".request");return $$.emit(h+".refresh")}$$.emit(h+".request",n)}),$$.on(h+".refreshed",function(t,o){return n.clear(),t&&n.rows.add(t),n.settings()[0]._bInitComplete&&(n.columns.adjust(),n.draw(void 0===o?!0:o)),$$.emit("grid."+e+".refreshed"),t}),$$.on(h+".added",function(e){n.row.add(e).draw();var t=n.settings()[0].aiDisplayMaster.indexOf(n.settings()[0].aiDisplayMaster.length-1);if(t>=0){var o=Math.floor(t/n.page.info().length);o>-1&&n.page(o).draw(!1)}}),$$.on("grid."+e+".pages",function(){return n.page.info().pages}),$$.on("grid."+e+".page",function(e){return arguments.length?void 0:n.page.info().page}),$$.on("grid."+e+".edit",function(e){var t=n.cell(e);t.data(t.data())}),$$.on("grid."+e+".update.begin",function(e){$.data(e,"_old",$(e).html()),$(e).html('<span class="save_indicator">שומר...</span>')}),$$.on("grid."+e+".update.end",function(e){var t=n.cell(e);t.data(t.data())}),$$.on("grid."+e+".validate.begin",function(e){var t=$(e).html();console.log("begin",t),$(e).html('<span class="yes_indicator">בודק...</span>').attr("_old",t)}),$$.on("grid."+e+".validate.end",function(e){var t=$(e).attr("_old");t&&($(e).attr("_old",null),console.log("end",t),$(e).html(t))}),$$.on("grid."+e+".update",function(t,o){function i(t){$$.emit("grid."+e+".update.end",s),$$.emit("grid."+e+".error",s,t.message?t.message:t.toString())}function a(){try{if(!$$.list(h+".update").length)throw new Error("no handler for "+h+".update");$$.emit("grid."+e+".update.begin",s),$$.on(h+".updated",function(t,o){return o!=c?console.log("ignore not row"):"object"!=typeof t?$$.emit("grid."+e+".error",s,t):(l.data(t),void $$.emit("grid."+e+".update.end",s))},1),$$.emit(h+".update",f,c)}catch(t){i(t)}}var s=t;$$.emit("grid."+e+".error",s,"");try{var l=n.row($(s).closest("tr")[0]);"TD"!==$(s).prop("tagName")&&(s=$(this).closest("td")[0]);var c=$.extend({},l.data()),d=n.def(s),u=n.fld(s);if(d.type){var p=$$.emit("type."+d.type+".validate",o);if(p)throw new Error(p)}if(d.req){var p=$$.emit("type.required.validate",o);if(p)throw new Error(p)}var f={},g=r.fldId?r.fldId:"id";g in c?f[g]=c[g]:f=c;var v=void 0===o||null===o?"":o,m="";if(u in c&&(m=void 0===c[u]||null===c[u]?"":c[u]),v.toString()===m.toString())return;if(f[u]=o,$$.exists(h+".validate")){$$.emit("grid."+e+".validate.begin",s);var p=$$.emit(h+".validate",f,c);if("?"==p)return void $$.once(h+".validated",function(t){$$.emit("grid."+e+".validate.end",s),t?i(t):a()});if($$.emit("grid."+e+".validate.end",s),p)throw new Error(p);a()}else a()}catch(b){i(b)}}),$$.on("grid."+e+".page.prev",function(){n.page("previous").draw(!1)}),$$.on("grid."+e+".page.next",function(){n.page("next").draw(!1)}),$$.on("grid."+e+".error",function(e,t){return show_err(e,t)})}function scroll_if_anchor(e,t){e="string"==typeof e?e:$(this).attr("href");var o=80;if(e&&0==e.indexOf("#")){var n=$(e);if(n.length)return $("html, body").animate({scrollTop:n.offset().top-o}),!1}}function goback(){history.back()}!function($){function isNode(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function isElement(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function toFloat(e){var t=parseFloat(e);return isFinite(t)||(t=0),t}function Events(){var e={},t={},o={data:"",grid:"",rst:"",dlg:"",type:"",window:""},n=function(e){var t=e.split(".");if(1!=t.length&&!(t[0]in o))throw new Error("namespace "+t[0]+" not register")};return{data:Obj({}),rsts:Obj({}),grids:Obj({}),dlgs:Obj({}),addNS:function(e){o[e]=""},reset:function(){e={},t={},o={data:"",grid:"",rst:"",dlg:"",type:"",window:""}},val:function(t,o){var n=e,r=void 0;return t in n&&(r=o?n[t].args:n[t].val),DEBUG&&console.log("get",t,r),r},list:function(t){var o=e;return t in o?o[t].funcs:[]},exists:function(t){var o=e;return!!(t in o&&o[t].funcs.length)},on:function(t,o,r,i){n(t);var a=e;return DEBUG&&console.log("register",t,r),"function"!=typeof o?Yes.err("event param must have function"):(t in a||(a[t]={on:t,funcs:[],val:void 0,args:void 0}),void 0===r&&(r=-1),a[t].funcs.push({f:o,max:r}),void(a[t].emited&&!i&&-1==r&&o.apply(this,a[t].args)))},off:function(t,o){DEBUG&&console.log("unregister",t);var n=e;if(t in n)for(var r=0;r<n[t].funcs.length;r++)if(n[t].funcs[r].f===o)return n[t].funcs.splice(r,1)},once:function(e,t){n(e),$$.on(e,t,1)},emit:function(){var t=arguments,o=t[0],r=t.length,i=new Array(r-1),a=e;DEBUG&&console.log("emit",o,t),n(o),o in a||(a[o]={on:o,funcs:[],val:void 0,args:void 0});for(var s=1;r>s;s++)i[s-1]=t[s];var l=a[o];l.val=i[0],l.args=i,l.emited=1,t=l.funcs;var c,d=t.length;for(s=0;d>s;s++){var u=t[s].f.apply(this,i);void 0!==u&&(c=u)}for(s=t.length-1;s>-1;s--)t[s].max>-1&&(t[s].max--,t[s].max||t.splice(s,1));return c},uniq:{register:function(e,o,n){return e in t?Yes.err("re-register is invalid"):void(t[e]={last:null,list:[],show:o,hide:n})},show:function(e,o){if(!(e in t))return Yes.err("must register before use");for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);return t[e].last&&t[e].hide(t[e].last),t[e].last=o,o?t[e].show.apply(this,n):void 0},hide:function(e){return e in t?void(t[e].last&&t[e].hide(t[e].last)):Yes.err("must register before use")}}}}function Obj(e,t,o){var n=function(e,t,o){try{Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!1,value:o})}catch(n){console.log("watch.err",n),e[t]=o}};if(void 0===e)return $.extend(Obj,Yes.event),Obj;if(e.addProp)return e;if(t&&(e._ractive=t,Object.observe?Object.observe(e,function(e){void 0!==o?e.forEach(function(e){t.update(o?o+"."+e.name:e.name)}):t.update()}):"undefined"!=typeof Proxy?e=new Proxy(e,{set:function(e,n,r){e[n]=r,void 0!==o?t.update(o+"."+n):t.update(n)}}):watch(e,function(){t.update()},0,!0)),n(e,"update",function(e){t&&t.update(e)}),e instanceof Array){n(e,"addProp",function(t,o,n){e.forEach(function(e){e.addProp(t,o,n)})}),n(e,"on",function(t,o){e.forEach(function(e){e.on(t,o)})}),n(e,"onb",function(t,o){e.forEach(function(e){e.onb(t,o)})}),n(e,"onall",function(t){e.forEach(function(e){e.onall(t)})});for(var r=0;r<e.length;r++)e[r]=Obj(e[r],t);return e}n(e,"addProp",function(e,n,r){var i=r;return t&&(i=function(){r.apply(this,arguments),t.update(void 0===o?void 0:o?o+"."+e:e)}),Object.defineProperty(this,e,{get:n,set:i}),this});var i=function(e,r,i,a){var s=e,l=e[r];if(e._watchers||(n(e,"_watchers",{}),n(e,"_befores",{}),n(e,"_getters",{})),e._watchers[r]){if(!i)return;for(var c=i.toString(),d=0;d<e._watchers[r].length;d++)if(e._watchers[r][d].toString()==c)return;return void e._watchers[r].push(i)}e._watchers[r]=[],i&&e._watchers[r].push(i);var u=1,p=e[r];delete e[r];var f=function(n,i){if(u)return l=n;var a=l,c=function(){f(n,1)};if(!i&&e._befores[r])for(var d=0;d<e._befores[r].length;d++){var p=e._befores[r][d].call(e,n,a,"set",r,c);if(void 0!==p&&!p)throw new Error("callback disallow set")}if(l=n,a!==n)for(var d=0;d<e._watchers[r].length;d++){var h=e._watchers[r][d];h.call(s,n,a,"set",r)}t&&t.update(void 0===o?void 0:o?o+"."+r:r)},h=function(){return e._getters[r]?e._getters[r].call(e,r):l};Object.defineProperty(e,r,{get:h,set:f,enumerable:!0}),void 0!==p&&(e[r]=p),u=0};return n(e,"get",function(e,t){if("."!=e.substr(0,1))throw"prop must begin dot";e=e.substr(1),i(this,e),t?this._getters[e]=t:delete this._getters[e]}),n(e,"onall",function(e){function t(t){for(var o in t){if(o&&"_"==o.substr(0,1))return;$$(t).on("."+o,e),"object"==typeof t[o]&&$$(t[o]).onall(e)}}return t(this),this}),n(e,"on",function(e,t,o){if(e&&"."==e.substr(0,1)){var n=e.substr(1);void 0!==this[n]&&t.call(this,this[n],void 0,"init",n),i(this,n,t),o&&(this._getters[n]=o)}else $(this).on(e,function(){var e=Array.prototype.slice.call(arguments);e.shift(),t.apply(this,e)});return this}),n(e,"onb",function(e,t){if(e&&"."==e.substr(0,1)&&(e=e.substr(1)),e){i(this,e),this._befores[e]||(this._befores[e]=[]);for(var o=t.toString(),n=0;n<this._befores[e].length;n++)if(this._befores[e][n].toString()==o)return this;return this._befores[e].push(t),this}}),n(e,"emit",function(t){var o=Array.prototype.slice.call(arguments);if(o.shift(),t&&"."==t.substr(0,1)){var n=t.substr(1);if(!this._watchers||void 0==this._watchers[n])return;o.length<3&&(o[2]="emit"),o.length<4&&(o[3]=n);for(var r=0;r<this._watchers[n].length;r++){var i=this._watchers[n][r];i.apply(this,o)}}else $(e).trigger(t,o);return this}),e}var srcon=$.fn.on;$.fn.on=function(e){return"string"==typeof e&&"."==e.substr(0,1)?(console.log(e),this):srcon.apply(this,arguments)},$.eventEmitter={_JQInit:function(){this._JQ=$(this)},emit:function(e,t){!this._JQ&&this._JQInit(),this._JQ.trigger(e,t)},once:function(e,t){!this._JQ&&this._JQInit(),this._JQ.one(e,t)},on:function(e,t){!this._JQ&&this._JQInit(),this._JQ.bind(e,t)},off:function(e,t){!this._JQ&&this._JQInit(),this._JQ.unbind(e,t)}};var glob=[];window._glob=glob,function(){glob.reset=function(){id_counter=1,glob.length=0},"UID"in Object.prototype||(id_counter=1,Object.defineProperty(Object.prototype,"__uniqueId",{writable:!0,enumerable:!1}),Object.defineProperty(Object.prototype,"forEach",{configurable:!0,enumerable:!1,value:function(e){var t=this;for(var o in t)if(e(t[o],o))break}}),Object.defineProperty(Object.prototype,"UID",{enumerable:!1,get:function(){return void 0==this.__uniqueId&&(glob.length||(id_counter=1),this.__uniqueId=id_counter++,glob[this.__uniqueId]=this),glob[this.__uniqueId]||(glob[this.__uniqueId]=this),
this.__uniqueId>=id_counter&&(id_counter=this.__uniqueId+1),this.__uniqueId},set:function(e){/[0-9]+/.test(e)&&(glob[e]=this,this.__uniqueId=e,e>id_counter&&(id_counter=e+1))}}),Object.defineProperty(Array.prototype,"max",{enumerable:!1,value:function(){return Math.max.apply(null,this)}}),Object.defineProperty(Array.prototype,"min",{enumerable:!1,value:function(){return Math.min.apply(null,this)}}),Object.defineProperty(Array.prototype,"first",{enumerable:!1,value:function(){return this.length?this[0]:void 0}}),Object.defineProperty(Array.prototype,"last",{enumerable:!1,value:function(){return this.length?this[this.length-1]:void 0}}),Number.prototype.pad=function(e){return(Array(e).join("0")+this).slice(-e)},Object.defineProperty(Array.prototype,"average",{enumerable:!1,value:function(){for(var e=0,t=0,o=0;o<this.length,isFinite(this[o]);o++)e+=parseInt(this[o]),++t;return t?e/t:0}}))}();var org_show=$.fn.show;$.fn.show=function(){return $(this).removeClass("hide"),org_show.apply(this,arguments)},$.extend(!0,window,{SERVER_URL:"",PROJ:"",Yes:{ls:function(e,t){var o=localStorage;if(arguments.length<2){var n=o.getItem(e);try{n&&(n=JSON.parse(n))}catch(r){}return n}o.setItem(e,JSON.stringify(t))},traceInput:function(e,t){function o(e,t,o){var n="",r="";return e.length>t.length?(n="deletion",changeLength=e.length-t.length,pos=o,r=e.substr(pos,changeLength)):(n="insertion",changeLength=t.length-e.length,pos=o-changeLength,r=t.substr(pos,changeLength)),{text:r,type:n,position:pos,changeLength:changeLength}}$(e).bind("paste cut keydown",function(e){var n=this;setTimeout(function(){"undefined"==typeof $(n).data("old_value")&&$(n).data("old_value",$(n).val()),t&&t.call(n,o($(n).data("old_value"),$(n).val(),e.target.selectionStart)),$(n).data("old_value",$(n).val())},200)})},copy:function(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();var o;try{o=document.execCommand("copy"),o||console.log("Oops, unable to copy")}catch(n){console.log("Oops, unable to copy")}return document.body.removeChild(t),o},obj:function(e){return glob[e]},page:{events:Events(),data:{},csss:{},reset:function(e,t){e||(e="._main_page"),t||(t="._main_dialog"),Yes.event.reset(),$$.data={},$$.rsts={},$$.grids={},$$.dlgs={},$(e).replaceWith($("<div></div>").attr("class",$(e).attr("class")).attr("role",$(e).attr("role"))),$(t).replaceWith($("<div></div>").attr("class",$(t).attr("class")).attr("role",$(t).attr("role")))},"goto":function(page,params,trgMain,trgDlgs){$$.emit("window.unload"),trgMain||(trgMain="._main_page"),trgDlgs||(trgDlgs="._main_dialog"),Yes.page.reset(trgMain,trgDlgs);var c=$.extend({},params,{_ajax:1}),e=Yes.server(c,"","ajax/"+page);e=e.split(/\]\]!>(\w+)<!\[\[/),e.shift();for(var x={main:"",dialogs:"",init:"",css:""},i=0;i<e.length;i+=2)x[e[i]]=e[i+1];if(x.css)if(page in Yes.page.csss&&Yes.page.csss[page].css==x.css);else{page in Yes.page.csss||(Yes.page.csss[page]={}),Yes.page.csss[page].css=x.css;var w=Yes.page.csss[page].$=$("<style>"+x.css+"</style>");$("head").append(w)}$(trgMain).append(x.main),$(trgDlgs).append(x.dialogs),x.init&&eval(x.init),$$.emit("window.ready.after"),$$.emit("window.ready.end")}},event:Events(),DATE_FORMAT:{ISO8601_FORMAT:"yyyy-MM-dd hh:mm:ss",ISO8601_WITH_TZ_OFFSET_FORMAT:"yyyy-MM-ddThh:mm:ssO",DATETIME_FORMAT:"dd MM yyyy hh:mm:ss",ABSOLUTETIME_FORMAT:"hh:mm:ss.SSS"},str2dt:function(e){if(e=e.split(" "),(e[0].indexOf("/")>-1||e[0].indexOf("."))&&e[0].indexOf("-")<0){var t=e[0].split(/[\/\.]/);2==t.length&&(t[2]=(new Date).getFullYear()),e[0]=t[2]+"-"+t[1]+"-"+t[0]}return e=e.join(" "),new Date(1e3*strtotime(e))},update_date:function(e){var t=$(e).attr("data-fld");t&&e._ractive&&e._ractive.root.set_src&&e._ractive.root.set_src(e._ractive.keypath+"."+t,e.value)},stop:function(e){e||(e=window.event),e.stopPropagation(),e.preventDefault()},dt2str:function(e){function t(e,t){for(var o=e+"";o.length<t;)o="0"+o;return o}function o(e){return t(e,2)}function n(e){var t=Math.abs(e.getTimezoneOffset()),o=String(Math.floor(t/60)),n=String(t%60);return 1==o.length&&(o="0"+o),1==n.length&&(n="0"+n),e.getTimezoneOffset()<0?"+"+o+n:"-"+o+n}var r=Yes.DATE_FORMAT.ISO8601_FORMAT;if("string"==typeof e&&arguments.length>1&&(r=arguments[0],e=arguments[1]),"string"==typeof e&&e.replace(/[0\-:\. ]/g,"")&&(e.match(/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9]|)$/)&&r.match(/h{1,2}:mm(:ss|)/)&&(e="2000-01-01 "+e),e=Yes.str2dt(e)),"number"==typeof e&&(e=new Date(e)),null===e||void 0===e||"string"==typeof e||e.getTime()!==e.getTime())return"";var i=o(e.getDate()),a=o(e.getMonth()+1),s=o(e.getFullYear()),l=o(e.getFullYear().toString().substring(2,4)),c=r.indexOf("yyyy")>-1?s:l,d=o(e.getHours()),u=o(e.getMinutes()),p=o(e.getSeconds()),f=t(e.getMilliseconds(),3),h=n(e),g=r.replace(/dd/g,i).replace(/MM/g,a).replace(/y{1,4}/g,c).replace(/hh/g,d).replace(/mm/g,u).replace(/ss/g,p).replace(/SSS/g,f).replace(/O/g,h);return g},dateDiff:function(e,t,o){e=e.toLowerCase();var n=o-t,r={w:6048e5,d:864e5,h:36e5,n:6e4,s:1e3};return Math.floor(n/r[e])},err:function(e){throw console.log("Err:",e),new Error(e)},json:function(e){return $.toJSON(e)},share:function(e,t,o){return e.proj=Yes.PROJ,Yes.server(e,t,"/share/data")},server:function(e,t,o){function n(o){return t?$$.emit(t,o.toString(),e):void Yes.err(o)}Yes.SERVER_URL||o||Yes.err("must spec server url");var r=null;return DEBUG&&console.log("request",e),$.ajax({url:o||Yes.SERVER_URL,type:"POST",contentType:"application/json",processData:!1,dataType:e._ajax?"text":"json",data:JSON.stringify(e),async:!1,cache:!1,complete:function(o,i){if(e._ajax)return r=o.responseText;var a="";if(200==o.status){if(o&&o.responseJSON)a=o.responseJSON;else if(o&&void 0!==o.responseText)try{a=$.parseJSON(o.responseText)}catch(s){}else if("string"==typeof o)try{a=$.parseJSON(o)}catch(s){}else a=o;if(a&&a.error)return n(a.error.message?a.error.message:a.error);if(!a||!a.result)return n(o&&o.responseText?o.responseText:o);if("OK"!=a.result)return n(a.err);r=a.data,Yes.server._last_data=r,t&&$$.emit(t,r,e)}},error:function(e,t,o){var r=e.responseJSON&&e.responseJSON.error?e.responseJSON.error.message:e.responseText.split("&nbsp;at ")[0];r&&(r=r.replace("<br> &nbsp;","").replace(/(Error: ?|Err: ?)/g,"").replace(/<br> {0,}$/,"")),n(r)},fail:function(e){n("fail connect:"+e)}}),r},arr2obj:function(e,t){for(var o={},n=0;n<e.length;n++)o[e[n][t]]=e[n];return o},obj2arr:function(e){var t=[];for(var o in e)t.push(e[o]);return t},initResize:function(e,t){Yes._initResize||(Yes._initResize=1,window.resize_box=null,$(document).mousemove(function(e){resize_box&&(resize_box.obj.triggerHandler(e,resize_box.info),Yes.stop(e),event.returnValue=!1)}).mouseup(function(e){if(resize_box){var t=resize_box;window.resize_box=null,t&&t.obj.triggerHandler(e,t.info),Yes.stop(e)}})),window.resize_box={obj:$(e),info:t}},resize:function(e){e||err("param missing");var t=$.extend({},e),o=$(t.obj);void 0!==t.scale?t.scale:1;o.mousedown(function(e){var o=t.trg||this,n=$.isFunction(t.scale)?t.scale():void 0!==t.scale?t.scale:1,r=$.isFunction(t.scale_move)?t.scale_move():void 0!==t.scale_move?t.scale_move:n,i={opt:t,sc:n,sc_move:r,pageX:e.pageX,pageY:e.pageY,src:Yes.abs_pos(o,null,n),trg:o};if($.isFunction(t.before)){var a=t.before.apply(this,[i,e]);if(void 0!==a){if(!a)return;a&&(i.trg=a)}}i.src=Yes.abs_pos(i.trg,null,n),t.relative&&(i.src.top=toFloat($(i.trg).css("top")),i.src.left=toFloat($(i.trg).css("left")),i.src.right=toFloat($(i.trg).css("right"))),Yes.initResize(this,i),Yes.stop(e)}).mousemove(function(e,o){if(e.which&&o){var n=$(o.trg),r={};if(void 0!==t.y){var i=o.src.top,a=(e.pageY-o.pageY)/o.sc_move,s=i+a,l=[];t.min&&void 0!==t.min.y&&t.min.y>s&&l.push(t.r.y),t.min&&void 0!==t.min.y2&&t.min.y2>s+o.src.height&&l.push(t.min.y2-o.src.height),l.length&&(l=l.min(),s>l&&(console.log("min block y "+s),s=l)),l=[],t.max&&void 0!==t.max.y&&t.max.y<s&&l.push(t.max.y),t.max&&void 0!==t.max.y2&&t.max.y2<s+o.src.height&&l.push(t.max.y2-o.src.height),l.length&&(l=l.max(),l.length&&l>s&&(console.log("max block y "+s),s=l)),r.top=s}if(void 0!==t.x||void 0!==t.x1){var c=void 0!==t.x?"right":"left",d="right"==c?-1:1,i=o.src[c],a=(e.pageX-o.pageX)/o.sc_move*d,s=i+a,l=[];t.min&&void 0!==t.min.x&&t.min.x>("right"==c?s:s+o.src.width)&&l.push(t.min.x+("right"==c?0:o.src.width)),t.min&&void 0!==t.min.x1&&t.min.x1>("left"==c?s:s+o.src.width)&&l.push(t.min.x+("left"==c?0:o.src.width)),l.length&&(l=l.min(),s>l&&(console.log("min block x "+s),s=l)),l=[],t.max&&void 0!==t.max.x&&t.max.x<("right"==c?s:s+o.src.width)&&l.push(t.max.x+("right"==c?0:o.src.width)),t.max&&void 0!==t.max.x1&&t.max.x1<("left"==c?s:s+o.src.width)&&l.push(t.min.x+("left"==c?0:o.src.width)),l.length&&(l=l.max(),l>s&&(console.log("max block x "+s),s=l)),r[c]=s,r["right"==c?"left":"right"]="auto"}if(void 0!==t.w){var i=o.src.width,a=(e.pageX-o.pageX)/o.sc_move,s=i-a;t.min&&void 0!==t.min.w&&t.min.w>s&&(s=t.min.w),t.max&&void 0!==t.max.w&&t.max.w<s&&(s=t.max.w),r.width=s}if(void 0!==t.h){var i=o.src.height,a=(e.pageY-o.pageY)/o.sc_move,s=i+a;t.min&&void 0!==t.min.h&&t.min.h>s&&(s=t.min.h),t.max&&void 0!==t.max.h&&t.max.h<s&&(s=t.max.h),r.height=s}if($.isFunction(t.move)){var u=t.move.apply(this,[o,r,e]);if(void 0!==u&&!u)return}n.css(r),Yes.stop(e)}}).mouseup(function(e,o){if(o){var n=(e.pageY-o.pageY)/o.sc_move,r=(e.pageX-o.pageX)/o.sc_move;Yes.stop(e);try{$.isFunction(t.after)&&t.after.apply(this,[r,n,o,e])}catch(e){alert(e.message?e.message:e)}}}).click(function(e){Yes.stop(e)})},abs_pos:function(e,t,o){t||(t="body");var n=t;if(n="string"==typeof t?$(e).closest(t):$(n),n.length){var r=void 0!=o?o:toFloat($(e).closest("*[scY]").attr("scY")),i=$(n)[0].getBoundingClientRect(),a=$(e)[0].getBoundingClientRect();return{col:n,top:(a.top-i.top)/r,left:(a.left-i.left)/r,right:(i.right-a.right)/r,width:a.width/r,height:a.height/r}}},set_by_path:function(e,t,o,n){var r=e._ractive;r||Yes.err("not in rst");var i=r.root.get(r.keypath),a=void 0!==o&&"~/"==t.substr(0,2)?t.substr(2):r.keypath+(r.keypath?".":"")+t;void 0===o?r.root.set(r.keypath,t):r.root.set(a,o),n&&r.root.data.emit?r.root.data.emit(n,o,i,t):n&&i&&i.emit&&i.emit(n,o)},get_by_path:function(e){var t=e._ractive;return t||Yes.err("not in rst"),t.root.get(t.keypath)},get_path:function(e){var t=e._ractive;return t||Yes.err("not in rst"),t.keypath}}}),$.extend(!0,window,{$$:Obj()}),Object.defineProperty($$,"socket",{get:function(){if(!$$._sock){var e=$$._sock=io("/"+encodeURI(proj_path),{"force new connection":!0});e.onUID=function(t){e.serverUID?t(e.serverUID):e.emit(".UID",function(e){t(e)})},$$._sock.on("connect",function(){var t=e.onevent;e.onevent=function(o){var n=o.data||[];console.log("***","onevent",o,n[0]),t.call(e,o)}}).on(".UID",function(t){e.serverUID=t})}return $$._sock},set:function(){}})}(jQuery),$.fn.editable&&($.fn.editable.defaults.mode="inline"),window.onerror=function(e){try{$$&&$$.p&&$$.p.exists("error")?$$.p.emit("error",e.message?e.message:e.toString(),window.event):$$?$$.emit("error",e.message?e.message:e.toString(),window.event):alert(e)}catch(t){alert(e)}},"undefined"!=typeof TraceKit&&TraceKit.report.subscribe(function(e){if(e.url=window.location.href,!("log_error"in $$)||$$.log_error)try{Yes.share({cmd:"log_error",info:e})}catch(t){console.error("log error fail",e,t)}}),$(window).ready(function(){init_data();var x={};Object.defineProperty(x,"errors",{configurable:!0,enumerable:!1,value:{}}),Object.defineProperty(x,"Yes",{configurable:!0,enumerable:!1,value:Yes}),Object.defineProperty(x,"$$",{configurable:!0,enumerable:!1,value:$$}),Object.defineProperty(x,"dt2str",{configurable:!0,enumerable:!1,value:Yes.dt2str}),Object.defineProperty(x,"str2dt",{configurable:!0,enumerable:!1,value:Yes.str2dt}),Ractive.defaults.data=x;var r=document.location.pathname;$('#navbar a[href="'+r+'"]').parent().addClass("active"),$("body").on("click","a",scroll_if_anchor),$(".init_combobox").combobox(),window._modal_mopen=[];var oldJQueryEventTrigger=$.event.trigger;$.event.trigger=function(e){oldJQueryEventTrigger.apply(this,arguments),"bs.modal"==e.namespace&&e.target&&("shown"==e.type&&window._modal_mopen.push(e.target),"hidden"!=e.type&&"hide"!=e.type||window._modal_mopen.splice(_modal_mopen.indexOf(e.target),1))},$(document).keydown(function(e){if(27==e.which){var t=$(e.target).parents(".popover,.modal-content")[0];if(t)$(".close",t).eq(0).click(),Yes.stop(e);else{var t=window._modal_mopen.last();t&&($(".close",t).eq(0).click(),Yes.stop(e))}}}),$(document).on("click",".panel-heading",function(){var e=$(this.parentNode);e.hasClass("fixed-icn")||(e.toggleClass("icn"),$(".panel-collapse",e).collapse("toggle"))}),$.fn.combobox.Constructor.prototype.refresh=function(){this.$source.val()||(this.clearTarget(),this.$element.val("")),this.source=this.parse(),this.options.items=this.source.length};var pt=$.fn.combobox.Constructor.prototype,src={show:pt.show,setup:pt.setup,parse:pt.parse,matcher:pt.matcher,sorter:pt.sorter,highlighter:pt.highlighter,select:pt.select};pt.show=function(){var e=src.show.apply(this,arguments);return this.$container.closest(".input-group").hasClass("dropup")&&this.$menu.css({top:"auto"}),e},pt.toggle=function(){if(!this.disabled)if(this.$container.hasClass("combobox-selected")&&this.$source.hasClass("not-require"))this.clearTarget(),this.triggerChange(),this.clearElement();else if(this.shown)this.hide();else if(this.$source.hasClass("not-require"))this.clearElement(),this.lookup();else{var e=this.$element.val();this.clearElement(),this.lookup();var t=e?this.$menu.find('li[data-value="'+e.replace(/"/g,'\\"')+'"]'):null;t&&($(".active",this.$menu).removeClass("active"),this.$element.val(e),t.addClass("active"))}},pt.select=function(){event&&"click"==event.type||this.$element.val()||this.$menu.find(".active").removeClass("active");var e=this.map[this.$menu.find(".active").attr("data-value")];if(void 0!==e&&!$('option[value="'+e.toString().replace(/"/g,'\\"')+'"]',this.$source).length){var t=document.createElement("option");t.value=t.text=e,this.$source[0].add(t)}src.select.apply(this,arguments)},pt.setup=function(){var e=src.setup.apply(this),t=this.$source.attr("lookup");if(!t)return e;var o,n=t;if(this.$source[0]._ractive)o=this.$source[0]._ractive.root;else{if(t=t.split("."),t.length<1)return e;if(o=$$.rsts[t[0]],t.shift(),n=t.join("."),!o)return e}return lookup_fld=this.$source.attr("lookup_fld"),lookup_id=this.$source.attr("lookup_id"),lookup_add=this.$source.attr("lookup_add"),lookup_add&&("["==lookup_add[0]?lookup_add=JSON.parse(lookup_add):lookup_add=lookup_add.split(",")),this.ract={ract:o,keypath:n,src_keypath:this.$source[0]._ractive?this.$source[0]._ractive.keypath:null,lookup_fld:lookup_fld,lookup_id:lookup_id,lookup_add:lookup_add?lookup_add:[]},e},pt.highlighter=function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return""===t?e:void 0===e||null===e?e:e.toString().replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},pt.parse=function(){this.$source.attr("lookup");if(!this.ract)return src.parse.apply(this);var e,t=this.ract.ract,o={},n={},r=[],i=this.ract.lookup_fld,a=this.ract.lookup_id,s=t.get(this.ract.keypath),l=s instanceof Array,c=this.$source.val(),d=function(t,s){var d=i?t[i]:t,u="_id"==a||!l&&!a?s:a?t[a]:t;r.push(d),o[d]=u,!c||o[d]!=c&&d!=c||(e=d,d==c&&(c=u)),n[d]=t};if(l)s.forEach(d);else for(var u in s)d(s[u],u);if(this.ract.lookup_add&&this.ract.lookup_add.forEach(function(e){if("string"==typeof e){var t={};t[i]=e,t[a]=e,d(t,"_id"==a?r.length:e)}else d(e,"_id"==a?r.length:e[a])}),this.mapObj=n,this.map=o,null!==c&&""!==c){this.$target.val(c),this.$element.closest("#lookup").length&&this.$element.css({"min-width":"auto",width:"0%"}),this.$element.val(e);var p=this;this.$element.closest("#lookup").length&&setTimeout(function(){p.$element.css({"min-width":p.$element.prop("scrollWidth")+3,width:"100%"})},10),void 0===e&&this.$source.attr("no-limit")&&this.$element.val(c),this.$container.addClass("combobox-selected"),this.selected=!0}return r},$.fn.combobox.Constructor.prototype.blur=function(e){var t=this;this.focused=!1;var o=this.$element.val();if(this.$source.attr("no-limit")){if(!this.selected&&""!==o&&this.source.indexOf(o)<0){var n=document.createElement("option");$(n).attr("selected",1),n.value=n.text=o,this.$source[0].add(n),this.refresh(),this.$source.val(o).trigger("change"),this.ract&&this.ract.ract.update(this.ract.src_keypath)}}else if(!this.selected){var r=this.$element.val();r&&this.$source.attr("add_event")&&$$.emit(this.$source.attr("add_event"),r,this.$source[0]),this.$element.val(""),this.$source.val(""),this.$target.val(""),this.$source.trigger("change"),this.$target.trigger("change"),this.ract&&this.ract.ract.update(this.ract.src_keypath)}!this.mousedover&&this.shown&&setTimeout(function(){t.hide()},200)},$(document).on("focus keyup","textarea.autoresize",function(){var e=1*$(this).css("height").replace("px","");e+5<=$(this).prop("scrollHeight")&&$(this).css("height",$(this).prop("scrollHeight")+20)}),$(window).on("message onmessage",function(e){console.log(e),e.originalEvent.origin.indexOf(":3385")>-1&&eval(e.originalEvent.data)}),$(window).load(function(){$$.emit("window.ready.before"),$$.emit("window.ready"),$$.emit("window.ready.after"),$(document).on("click",".nav-stacked li a",function(){$(this).parent().parent().find(".active").removeClass("active"),$(this).parent().addClass("active")}),window._refreshCombo=function(e){function t(e,t){if(document.createEvent){var o=document.createEvent("HTMLEvents");o.initEvent(t,!1,!1),e.dispatchEvent(o)}else document.createEventObject&&e.fireEvent("on"+t)}$(".datetimepicker>input:enabled",e).parent(".datetimepicker").each(function(e,o){var n=$(o);return n.data("DateTimePicker")?n.find("input").trigger("change"):(n.hasClass("datetime")?n.datetimepicker({format:"YYYY-MM-DD HH:mm",language:"he",sideBySide:1,todayHighlight:!0}):n.hasClass("time")?n.datetimepicker({format:"HH:mm",language:"he",sideBySide:1,pickDate:0,pickTime:1}):n.hasClass("month")?n.datetimepicker({format:"YYYY-MM",language:"he",viewMode:"months",sideBySide:1,pickDate:1,pickTime:0,minViewMode:1}):n.datetimepicker({format:"YYYY-MM-DD",language:"he",pickTime:0,todayHighlight:!0}),void n.on("dp.hide",function(e){t($(e.currentTarget).find("input").get(0),"change")}))}),$("select.combobox",e).combobox()},_refreshCombo(),$(".btn-toggle").click(function(){$(this).find(".btn").toggleClass("active"),$(this).find(".btn-primary").size()>0&&$(this).find(".btn").toggleClass("btn-primary"),$(this).find(".btn").toggleClass("btn-default")}),$$.emit("window.ready.end")}),scroll_if_anchor(window.location.hash,1)}),jQuery.fn.dataTableExt.oApi.fnProcessingIndicator=function(e,t){void 0===t&&(t=!0),this.oApi._fnProcessingDisplay(e,t)},$.fn.dataTable.ext.order["dom-checkbox"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return $("input",e).prop("checked")?"1":"0"})};
//# sourceMappingURL=my.js.map