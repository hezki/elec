function init(){function t(t){if(t.dirty){var e=t.bak;delete t.bak;for(var s in e)t[s]=e[s];delete t.dirty}}function e(t){var e,s=[],a=$$.rsts.select_date;t.forEach(function(t,a){!e&&t.date&&(e=t),a=a/7>>0,s[a]||(s[a]=[]),s[a].push(t)}),s.last().length=7,a.set("weeks",s),a.set("date",e.date),a.set("cal_date",0==a.data.cal_type?e.gmon+" "+e.date.split("-")[0]:e.hmon+" "+e.hyear)}var s=/(android)/i.test(navigator.userAgent);s&&($(".area").css({position:"relative"}),$(".flex").removeClass("flex"),$(".flex1").removeClass("flex1"),$(".left,.right").width("auto"),$(".right").css({padding:"10px"}),$(".left").insertAfter(".right")),window.scale=function(t,e,s){var a=$(t);s?$(t).css({transformOrigin:"100% 0%",transform:" scale("+e+","+s+")"}).attr("scY",s).attr("scX",e):a.css({transformOrigin:"100% 100%",transform:" scaleX("+e+")"}).attr("scX",e)},$$.on("window.ready.after",function(){s&&($(".edit_in_area").css({position:"relative"}),$(".cmds_btns").css({position:"fixed",top:"auto",bottom:"120px"})),$.fn.select2.defaults.set("allowClear",!0),$.fn.select2.defaults.set("templateResult",function(t){return t.element&&"<"==t.element.innerHTML.substr(0,1)?$(t.element.innerHTML):t.text}),$.fn.select2.defaults.set("templateSelection",function(t){return t.element&&"<"==t.element.innerHTML.substr(0,1)?$(t.element.innerHTML):t.text});var t;register_pop("cmd_type_pop","נוסחא"),void 0!==document.onmousewheel?t="onmousewheel":void 0!==document.onwheel&&(t="onwheel");var e=1;$(".area")[0][t]=function(t){var s=window.event||t;t.preventDefault();var a=s.detail?-120*s.detail:s.wheelDelta;a=a/120/20,a=e*(1+a),1>a&&(a=1),e=a,$(".day-stt").css("zoom",a),$(".new-tbl").css("zoom",a),$(".area-days-in td,.area-data-in td").width(120*a),$(".area-names-in td,.area-data-in td,.name-in").height(25*a),$(".area-data-in,.area-days-in").width(840*a)};var i,r;window.go_edit=function(t,e,s,i){a.sid=t,a.mid=e,a.edit_date=s,$$.rsts.edit.update(),i&&($(i).scrollintoview().removeClass("flash"),setTimeout(function(){$(i).addClass("flash")},1)),a.edit_mode="edit"},$(document).on("dblclick click",".part,.start,.end,.on",function(t){if(!("edit"!=a.edit_mode&&"dblclick"!=t.type||i&&(Math.abs(i.x-t.clientX)>5||Math.abs(i.y-t.clientY)>5))){Yes.stop(t);var e,s,r;if($(this).hasClass("part")){var n=$(this),d=$$.rsts.stt,c=d.get(this._ractive.keypath),o=n.attr("day");e=d.data.days[o].matcon.mc.id,r=c.id}else{var n=$(this),d=$$.rsts.stt,c=d.get(this._ractive.keypath),o=n.closest(".day-stt").attr("day");$(this).hasClass("start")||$(this).hasClass("on")?(s=c.m_b?"#cmd_"+c.id_b:"#tmp_"+c.id_b,e=c.m_b||a.mid):(s=c.m_e?"#cmd_"+c.id_e:"#tmp_"+c.id_e,e=c.m_e||a.mid),r=$(this).closest("tr").attr("sid")}go_edit(r,e,o,s)}}),$(document).on("click",".day-stt",function(t){}),$(document).on("click",".start,.end,.on",function(t){}),$(document).on("click",".area",function(){}),$(".area").mousedown(function(t){i={down:1,x:t.clientX,y:t.clientY,top:$(".area").scrollTop(),left:$(".area").scrollLeft()},Yes.stop(t)}).mousemove(function(t){if(t.which&&i&&i.down){var e=t.clientX-i.x,s=t.clientY-i.y;$(".area").scrollTop(i.top-s);var a=i.left-e;$(".area").scrollLeft(a),e=$(".area").scrollLeft()-a,Math.abs(e)>150&&Math.abs(s)<15&&(clearTimeout(r),r=setTimeout(function(t){i=null,$(".new-tbl").css({"transform-origin":"fnext"==t?"100% 0":"0 0",transform:"scaleX(0)"}),setTimeout(function(){$(".new-tbl").css({"transform-origin":"fnext"!=t?"100% 0":"0 0"})},50),$$.emit("goto",t),$("body").click()},100,i.left-e<0?"fnext":"fprev")),Yes.stop(t)}}).mouseup(function(t){i&&(i.down=0),Yes.stop(t)})}),$$.on("toggle_btn",function(){if(Yes.stop(event),a.sw){var t={localy:1,cmd:"hand_cmds",type:"add",s:a.sw.id,date:"now"};t["1"==a.sw.status?"off":"on"]=t.date,Yes.server(t),$$.emit("refresh"),a.emit("refresh_cmds_tmp")}}),$$.on("reset_matcon",function(){a.sw&&a.mid&&bootbox.confirm("לאפס את כל הפקודות?",function(t){t&&(Yes.server({localy:1,cmd:"reset",type:"matcon",s:a.sid,m:a.mid}),a.all.cmds=a.all.cmds.filter(function(t){return t.matcon!=a.mid||t["switch"]!=a.sid}),a.emit("refresh_cmds"))})}),$$.on("new_cmd",function(){a.sw&&a.mid&&(Yes.stop(event),$$.emit("dlg.new_cmd.show",{times:"",daysc:[1,1,1,1,1,1,1]}))}),$$.on("go_new_cmd",function(){var t=$$.rsts.new_cmd.data,e=t.times,s=a.mid,i=a.sid,r=t.daysc,n=parseInt(r.join(""),2),d={matcon:s,"switch":i,id:"",type:0,zman:0,days:n,action:1,time:"",disable:0,daysc:r,typec:"",timec:"",dirty:1};if(e){var c=[];e.replace(/ +([\-,])/g,"$1").replace(/([\-,]) +/g,"$1").replace(/ +/g,",").split(",").forEach(function(t){t.split("-").forEach(function(t,e){t&&(t=t.trim().replace(/\./g,":"),t.match(/^\d$/)&&(t+=":00"),t.match(/^\d\d$/)&&(t=t[0]+t[1]+":00"),t.match(/^\d\d\d$/)&&(t=t[0]+":"+t[1]+t[2]),t.match(/^\d\d\d\d$/)&&(t=t[0]+t[1]+":"+t[2]+t[3]),t.match(/^0\d/)&&(t=t.substr(1)),t.match(/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/)||Yes.err("הזמן "+t+" אינו תקין"),t.match(/^\d:/)&&(t="0"+t),c.push($.extend(!0,{},d,{time:t,timec:t,typec:t,action:0==e?1:2})))})}),a.all.cmds.push.apply(a.all.cmds,c)}else a.all.cmds.push(d);$$.emit("dlg.new_cmd.close"),a.emit("refresh_cmds"),$("#cmd_").scrollintoview()}),$$.on("expr_update",function(t,e,s,i){i&&i.length&&(recalc_expr(i[0],a.edit_date),$$.rsts.edit.update())}),$$.on("tmp_select_all",function(t){var e=$("select",$(event.srcElement).closest(".input-group")),s=$("option",e);"all"==t?s.prop("selected","selected"):"none"==t&&s.removeAttr("selected"),e.trigger("change")}),$$.on("new_tmp",function(){a.sw&&(Yes.stop(event),$$.emit("dlg.new_tmp.show",{date:a.edit_date,start:"",end:"",switchs:a.switchsA,s:[a.sid]}))}),$$.on("go_new_tmp",function(){function t(t,e){var a=0;return t.replace(/ +([\-,])/g,"$1").replace(/([\-,]) +/g,"$1").replace(/ +/g,",").split(",").forEach(function(t){a||t.split("-").forEach(function(r,n){if(!a&&r)if(r=r.trim().replace(/\./g,":"),r.match(/^\d$/)&&(r+=":00"),r.match(/^\d\d$/)&&(r=r[0]+r[1]+":00"),r.match(/^\d\d\d$/)&&(r=r[0]+":"+r[1]+r[2]),r.match(/^\d\d\d\d$/)&&(r=r[0]+r[1]+":"+r[2]+r[3]),r.match(/^0\d/)&&(r=r.substr(1)),r.match(/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/)||(a=1,Yes.err("הזמן "+r+" אינו תקין")),1==r.match(/:/g).length&&(r+=":00"),0==n)s[e].push($.extend({},i,{t:r}));else if(1==n){var d=s[e][s[e].length-1];d.r=1,d.e=r}else a=1,Yes.err("נתון שגוי: "+t)})}),a}if(Yes.stop(event),a.sw){var e=$$.rsts.new_tmp.data;0==e.s.length&&Yes.err("חובה לבחור לפחות מתג אחד");var s={on:[],off:[]},i={s:a.sw.id},r={};if(e.start){if(t(e.start,"on"))return;r.on="1_"+e.start}if(e.end){if(t(e.end,"off"))return;r.off="2_"+e.end}e.start||e.end||Yes.err("חובה לציין לפחות זמן אחד");var n=[];s.on.forEach(function(t){t.a=1,e.s.forEach(function(e){var s=$.extend({},t);s.s=e,s.src=r.on,n.push(s)})}),s.off.forEach(function(t){t.a=2,e.s.forEach(function(e){var s=$.extend({},t);s.s=e,s.src=r.off,n.push(s)})});var d={localy:1,cmd:"hand_cmds",type:"add",proc:n,date:e.date,src:e.src};Yes.server(d),$$.emit("dlg.new_tmp.close"),$$.emit("refresh"),a.emit("refresh_cmds_tmp")}}),$$.on("set_hand",function(){Yes.stop(),bootbox.confirm("האם אתה בטוח?",function(t){t&&(Yes.server({cmd:"set_hand",date:a.edit_date,grp:a.grp,matcon:a.mid}),a.emit("refresh"),a.emit("refresh_cmds"))})}),$$.on("set_auto",function(){Yes.stop(),Yes.server({cmd:"set_hand_auto",date:a.edit_date,grp:a.grp,matcon:a.mid}),a.emit("refresh"),a.emit("refresh_cmds")}),$$.on("set_lock",function(t){var e=a.sw,s={id:e.id};switch(t){case 0:s.locked=0;break;case 1:s.locked=1,s.lock_status=1;break;case 2:s.locked=1,s.lock_status=0}var i=Yes.server({cmd:"upd",type:"switchs",data:s,localy:1});_data.switchs[i.id]=$.extend(_data.switchs[i.id],i),a.emit("refresh")}),$$.on("today",function(){$$.emit("dlg.select_date.close"),a.date=new Date,a.emit("refresh"),a.edit_date=0,a.emit(".edit_date",0),go_edit(a.sid,0,0)}),$$.on("select_date",function(t){Yes.stop();var s=$$.rsts.select_date.data;s.cal_type=t;var i=Yes.server({cmd:"month",date:a.edit_date,cal_type:t,seek:"",grp:a.grp});$$.rsts.select_date.set("matcons",a.matcons),e(i),$$.emit("dlg.select_date.show")}),$$.on("cal_move",function(t){var s=$$.rsts.select_date.data,i=Yes.server({cmd:"month",date:s.date,cal_type:s.cal_type,seek:t,grp:a.grp});e(i)});var a,i;$$.on("window.ready.after",function(){$(".right").on("transitionend",function(t){0==$(this).width()&&$("#edit").hide()}),a=$$({}).on("init",function(){this.times={};var t=Yes.server({cmd:"init",localy:1});a=this,a.all={},a.cmds=[],a.edit_mode="status",a.all.switchsA=t.switchs,a.all.switchs=Yes.arr2obj(t.switchs,"id"),a.all.matconsA=t.matcons,a.all.matcons=Yes.arr2obj(t.matcons,"id"),t.grps.length<2&&$("#grps_list").hide(),a.grps=Yes.arr2obj(t.grps,"id"),a.grps_length=t.grps.length}).on("refresh_cmds",function(){this.all.cmds||(this.all.cmds=Yes.server({cmd:"rst",q:"cmds",f:"matcon,`switch`,id,`type`,zman,days,`action`,time,`disable`,share,last"})),this.all.cmds.forEach(function(t){t.daysc||(t.daysc=parseInt(parseInt(t.days).toString(2)).pad(7).split("")),void 0===t.last&&(t.last=t.action)});var t=this;if(this.cmds.length=0,$$.rsts.edit.update("cmds"),!this.m||!this.sw)return void $$.rsts.edit.update();var e=[];this.all.cmds.forEach(function(s){t.sw.id==s["switch"]&&t.m.id==s.matcon&&e.push(s)}),e.sort(function(t,e){if(s=e.daysc.filter(function(t){return"1"==t}).length-t.daysc.filter(function(t){return"1"==t}).length)return s;if(s=parseInt(t.days)-parseInt(e.days))return s;var s=(4==t.type?1:0)-(4==e.type?1:0);return s?s:t.timec==e.timec?0:t.timec>e.timec?1:-1}),t.cmds=e,$$.rsts.edit.update()}).on("refresh_cmds_tmp",function(){this.emit(".edit_date",this._last_dayi),this.emit("refresh")}).on(".sid",function(t){t?this.sw=this.switchs[t]:this.sw=void 0,this.emit("refresh_cmds")},function(){return this.sw?this.sw.id:""}).on(".m",function(){this.emit("refresh_cmds")}).on(".mid",function(t){t?this.m=this.matcons[t]:this.m=void 0},function(){return this.m?this.m.id:""}).on(".grp",function(t){t&&Yes.ls("def",$.extend(Yes.ls("def"),{grp:t})),a.matconsA=a.all.matconsA.filter(function(e){return e.grp==t}),a.matcons=Yes.arr2obj(a.matconsA,"id"),a.switchsA=a.all.switchsA.filter(function(e){return e.grp==t}),a.switchs=Yes.arr2obj(a.switchsA,"id"),this.emit("refresh"),setTimeout(function(){$("#grps .hide").removeClass("hide")},500)}).on(".edit_date",function(t){this._last_dayi=t,this.hfull_edit_date=a.days[t].hdate,this.gfull_edit_date=a.days[t].edate,this.day_matcon=a.days[t].matcon,this.mid=this.day_matcon.m,this.edit_date_str=a.days[t].edate;var e=a.days[t].edate,s={};Yes.server({localy:1,cmd:"list",type:"tmp",date:e}).forEach(function(t){s[t.s]||(s[t.s]=[]),t.ti=Yes.dt2str("hh:mm",Yes.str2dt(e+" "+t.t)),t.key=t.ti,t.id=t.a+"_"+(t.r?1:0)+"_"+t.t.replace(/:/g,"_"),t.r&&(t.xi=Yes.dt2str("hh:mm",Yes.str2dt(e+" "+t.e)),t.key=t.ti+" - "+t.xi),s[t.s].push(t)}),Object.keys(s).forEach(function(t){s[t]=s[t].sort(function(t,e){return t.ti>e.ti})}),this.tmp=s,e in this.times||(this.times[e]=Yes.server({cmd:"times_day",date:e})),this.all.cmds||(this.all.cmds=Yes.server({cmd:"rst",q:"cmds",f:"matcon,`switch`,id,`type`,zman,days,`action`,time,`disable`,share"})),this.units||(this.unitsA=Yes.server({localy:1,cmd:"list",type:"zmanim"}),this.units=Yes.arr2obj(this.unitsA,"id")),this.all.cmds.forEach(function(t){recalc_expr(t,e)}),$$.rsts.edit.update()},function(){return this.edit_date_str}).on(".edit_mode",function(t){switch(t){case"edit":if(a.edit_date||(a.edit_date=0),$$.rsts.grps.update(),s)return $("#edit").slideDown("slow");$("#edit").show(),$(".left").css({width:"50%",minWidth:"500px"}),$(".right").css({width:"50%",minWidth:"500px"});break;case"status":if($$.rsts.grps.update(),s)return $("#edit").slideUp("slow");$(".left").css({width:"100%",minWidth:"auto"}),$(".right").css({width:"0%",minWidth:"auto"}),$("#edit select.select2").each(function(t,e){$(e).data().select2&&$(e).select2("close")})}}).on("refresh",function(){function t(t){console.time("update");var e=["","א","ב","ג","ד","ה","ו","ש"];t.days.forEach(function(t){t.hwd=e[t.wd];var s=t.matcon;s.grpc=_data.grps[s.grp],0==s.m?s.mc={name:"[ללא מתכון]"}:s.m in _data.matcons?s.mc=_data.matcons[s.m]:s.mc={name:"[מתכון לא קיים]"}}),t.data=t.data.filter(function(t){return t.grp==a.grp}),t.data.forEach(function(t){function e(t){return t=t.split(":"),t.length>2&&t.pop(),"0"==t[0].substr(0,1)&&(t[0]=t[0].substr(1)),t.join(":")}if("1"==t.locked&&"0"==t.lock_status)for(var s=1;8>s;s++)t["w"+s]=[];a.all.switchs[t.id].status=t.status;for(var s=1;8>s;s++)t["w"+s].forEach(function(t){t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t.r=100*(t[0]/120),t.w=100*((120-t[1]-t[0])/120),t.length>3&&(t.id_b=t[3].replace(/:/g,"_"),t.id_e=t[4].replace(/:/g,"_"),t.m_b=t[5],t.m_e=t[6],t.m_e||t.id_e||(t.m_e=t.m_b),t.m_b||t.id_b||(t.m_b=t.m_e));var s=t[2].split("-");s.length>1&&(t.f=e(s[0]),"00:00:00"==s[0]&&(t.f=""),t.t=e(s[1]),"23:59:59"!=s[1]&&"00:00:00"!=s[1]||(t.t=""))})}),a=$.extend(a,t),a.day_matcon=a.days[a._last_dayi?a._last_dayi:0].matcon,$(".cmds").show(),$$.rsts.edit.update(),$$.rsts.stt.update(),setTimeout(function(){$(".new-tbl").css({transform:"scaleX(1)"})},50),console.timeEnd("update")}if(clearTimeout(i),this.no_ref||(i=setTimeout(function(){a.emit("refresh")},6e5)),!this.date)return this.date=new Date;console.time("request");var e=Yes.server({cmd:"week",date:Yes.dt2str("yyyy-MM-dd",this.date),grp:a.grp});console.timeEnd("request"),t(e)}).on(".date",function(t){var e=this;setTimeout(function(){e.emit("refresh")},10)}).on("load_def",function(){1==this.grps_length&&(this.grp=this.grps[Object.keys(this.grps)[0]]);var t=Yes.ls("def");if(t){var e=this;t.grp&&(e.grp=t.grp),s||setTimeout(function(){e.edit_mode="edit"},1e3)}}).emit("init").emit("load_def"),window._data=a,$$.rsts.stt.data=a,$$.rsts.edit.data=a,$$.rsts.grps.data=a,$$.rsts.stt.update(),$$.rsts.edit.update(),$$.rsts.grps.update(),$("#edit_table").on("mouseover","tr",function(t){var e=$(this).attr("id");if(e&&(e=e.split("_")[1])){var e=$(".start[cid="+e+"],.end[cid="+e+"]").removeClass("flashed");setTimeout(function(){e.addClass("flashed")},1)}}),$(".tcal").on("click",".info",function(t){var e=this._ractive.root.get(this._ractive.keypath);$$.emit("dlg.select_date.close"),a.date=new Date($(this).attr("date")),a.emit("refresh"),a.edit_date=0,a.emit(".edit_date",0),go_edit(a.sid,e.matcon,0)}),$("#edit_table").on("click","span",function(t){$$.uniq.hide("cmd_type_pop");var e=$(this).attr("section")?$(this).attr("section"):$(this).closest("td").attr("section");if(e){Yes.stop(t);var s=t.target._ractive.root,a=t.target._ractive.keypath,i=s.get(a);i.dirty||(i.bak=$.extend(!0,{},i),i.dirty=1,s.update(a+".dirty")),$$.emit("edit_"+e,s,a,i)}}),$("#new_cmd").on("click",".fixed .btn",function(t){var e=event,s=$(e.target),a=e.target._ractive.root,i=a.get(e.target._ractive.keypath);s=s.attr("d"),s&&(i.daysc[s]=1==i.daysc[s]?0:1,a.update())})}),$$.on("del_tmp",function(){var t=event,e=t.target._ractive.root,s=t.target._ractive.keypath,i=e.get(s);Yes.server({localy:1,cmd:"hand_cmds",type:"del",date:a.edit_date,t:i.t,a:i.a,r:i.r,s:a.sid}),a.emit("refresh_cmds_tmp")}),$$.on("edit_tmp",function(){var t=event,e=t.target._ractive.root,s=t.target._ractive.keypath,i=e.get(s);if(Yes.stop(event),i.src){var r={};a.tmp.forEach(function(t){t.forEach(function(t){t.src==i.src&&(r[t.s]=1)})}),r=Object.keys(r);var n={date:a.edit_date,start:"",end:"",switchs:a.switchsA,s:r};1==i.a?n.start=i.src.split("_")[1]:2==i.a&&(n.end=i.src.split("_")[1]),n.src=i.src,$$.emit("dlg.new_tmp.show",n)}}),$$.on("cancel",function(){$$.uniq.hide("cmd_type_pop");var e=event,s=e.target._ractive.root,i=e.target._ractive.keypath,r=s.get(i);return r.id?(t(r),void s.update(i)):(a.all.cmds.splice(a.all.cmds.indexOf(r),1),void a.emit("refresh_cmds"))}),$$.on("del_cmd",function(){$$.uniq.hide("cmd_type_pop");var t=event,e=t.target._ractive.root,s=t.target._ractive.keypath,i=e.get(s);return i?i.id?void bootbox.confirm("אתה בטוח?",function(t){if(t){if(a.all.cmds.splice(a.all.cmds.indexOf(i),1),!i.id)return a.emit("refresh_cmds");var e=Yes.server({localy:1,cmd:"del",tbl:"cmds",id:i.id});e&&a.all.cmds.forEach(function(t){t.share==i.share&&(t.share=0)}),a.days.forEach(function(t){t.matcon.m==i.matcon&&(e=1)}),e&&a.emit("refresh"),a.emit("refresh_cmds")}}):(a.all.cmds.splice(a.all.cmds.indexOf(i),1),void a.emit("refresh_cmds")):void 0}),$$.on("save",function(){var t=event,e=t.target._ractive.root,s=t.target._ractive.keypath,i=e.get(s);"0"!=i.action&&(0==i.type||4==i.type?i.zman=0:0==i.zman&&Yes.err("חובה לבחור אירוע"),i.time||Yes.err("חובה לציין שעה")),$$.uniq.hide("cmd_type_pop"),"0"==i.action&&"0"!=i.bak.action&&(i.last=i.bak.action),delete i.bak,delete i.dirty;var r={type:i.type,zman:i.zman,action:i.action,time:i.time,days:i.days,disable:i.dsiable,last:i.last};i.id?r.id=i.id:r=$.extend(r,{matcon:i.matcon,"switch":i["switch"]});var n=Yes.server({localy:1,cmd:"upd",type:"cmds",data:r});if(n.share&&"0"!=n.share)delete a.all.cmds,a.emit("refresh_cmds"),a.emit("refresh"),a.emit(".edit_date",a._last_dayi);else{i=$.extend(i,n);var d=0;a.days.forEach(function(t){t.matcon.m==i.matcon&&(d=1)}),d&&a.emit("refresh"),recalc_expr(n,a.edit_date)}e.update(s),e.update(s+".dirty")}),$$.on("goto",function(t){var e=864e5,s=+a.date;switch(t){case"next":s+=e;break;case"prev":s-=e;break;case"fnext":s+=7*e;break;case"fprev":s-=7*e}a.date=new Date(s)}),$$.on("edit_days",function(t,e,s){var a=event,i=$(a.target);if(i.hasClass("reset_days")){s||(t=i[0]._ractive.root,s=t.data,"days"in s||(s.days=127));var r=0==s.days?1:0;return s.daysc.forEach(function(t,e){s.daysc[e]=r}),s.days=parseInt(s.daysc.join(""),2),void t.update(e)}i=i.attr("d"),i&&(s.daysc[i]=1==s.daysc[i]?0:1,s.days=parseInt(s.daysc.join(""),2),t.update(e))}),$$.on("edit_action",function(t,e,s){1==s.action?s.action=2:2==s.action?s.action=0:(s.action=void 0!=s.last?s.last:1,s.last=void 0),t.update(e)}),$$.on("share",function(){var t=event;Yes.stop(t);var e=t.target._ractive.root,s=t.target._ractive.keypath,i=e.get(s);if(i&&"0"!=i.action){var r=[],n=[];a.matconsA.forEach(function(t){t.id!=i.matcon&&r.push(t)}),a.switchsA.forEach(function(t){t.id!=i["switch"]&&n.push(t)}),$$.rsts.share.set({m:[],s:[],matcons:r,switchs:n,key:s,obj:i}),_refreshCombo($("#share"));var d=i.share&&"0"!=i.share?Yes.server({localy:1,cmd:"list",type:"share",grp:i.share}):void 0;$$.rsts.share.set({m:d?d.m:[],s:d?d.s:[],old:d}),$$.emit("dlg.share.show")}}),$$.on("go_share",function(){var t=$$.rsts.share.data,e=(t.old,t.obj),s=t.m,i=t.s;(s.length||i.length||"1"==e.share)&&(Yes.server({localy:1,cmd:"share",src:e.id,m:t.m,s:t.s}),delete a.all.cmds,a.emit("refresh"),a.emit("refresh_cmds"),a.emit(".edit_date",a._last_dayi),$$.emit("dlg.share.close"))}),$$.on("edit_type",function(t,e,s){var a=event.target;s&&"0"!=s.action&&($$.rsts.expr.set({cmd:s,times:_data.unitsA}),_refreshCombo($("#expr")),$$.uniq.show("cmd_type_pop",a,$("#expr"),"נוסחא"))})}function str2sec(t){var e=t.split(":");return e[2]||(e[2]=0),Date.UTC(1970,0,1,e[0],e[1],e[2])/1e3}function sec2str(t){var e=parseInt(t,10),s=Math.floor(e/3600),a=Math.floor((e-3600*s)/60),i=e-3600*s-60*a;return 10>s&&(s="0"+s),10>a&&(a="0"+a),10>i&&(i="0"+i),s+":"+a+":"+i}function recalc_expr(t,e){var s=_data,a=s.times[e],i=a[0];t.daysc=parseInt(parseInt(t.days).toString(2)).pad(7).split("");var r=str2sec(t.time),n=sec2str(r);switch(t.typec=n,parseInt(t.type)){case 1:r=a[t.zman]-r,t.typec+=" לפני "+(s.units[t.zman]?s.units[t.zman].name:"?");break;case 2:r=a[t.zman]+r,t.typec+=" אחרי "+(s.units[t.zman]?s.units[t.zman].name:"?");break;case 3:r+=i,t.typec+=" אתמול";break;case 4:r+=i,t.typec+=" מחר";break;default:r+=i}t.timec=sec2str(r-i)}var DAY=864e5,ztc=60*new Date(0).getHours()*60*1e3;
//# sourceMappingURL=status.js.map